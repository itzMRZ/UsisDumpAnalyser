<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Summer 25 Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        button { padding: 8px 16px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Complete Summer 25 Debug Test</h1>

    <button onclick="runAllTests()">Run All Tests</button>
    <button onclick="clearResults()">Clear</button>

    <div id="results"></div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/dataService.js"></script>
    <script src="js/uiController.js"></script>

    <script>
        const results = document.getElementById('results');

        function addTest(name, passed, details) {
            const div = document.createElement('div');
            div.className = `test ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <h3>${passed ? '✅' : '❌'} ${name}</h3>
                <pre>${details}</pre>
            `;
            results.appendChild(div);
        }

        function clearResults() {
            results.innerHTML = '';
        }

        async function runAllTests() {
            clearResults();

            // Test 1: Config check
            const semester = CONFIG.dataSources.semesters.find(s => s.id === 'summer25');
            addTest('Config Test', !!semester, `Summer 25 config: ${JSON.stringify(semester, null, 2)}`);

            // Test 2: File loading
            try {
                const response = await fetch('summer-25.json');
                const data = await response.json();
                addTest('File Load Test', response.ok && Array.isArray(data),
                    `Status: ${response.status}, IsArray: ${Array.isArray(data)}, Length: ${data.length}`);

                // Test 3: Data normalization
                const normalized = Utils.normalizeCourseData(data, 'spring25');
                addTest('Normalization Test', normalized.length > 0,
                    `Input: ${data.length}, Output: ${normalized.length}, Sample: ${JSON.stringify(normalized[0], null, 2)}`);

                // Test 4: DataService loading
                await DataService.init();
                const loadedData = await DataService.setCurrentSemester('summer25');
                addTest('DataService Load Test', loadedData.length > 0,
                    `Loaded: ${loadedData.length} courses, State: currentData=${DataService._state.currentData.length}, filtered=${DataService._state.filteredData.length}`);

                // Test 5: Filter test
                DataService.filterData('');
                const filteredCount = DataService._state.filteredData.length;
                addTest('Filter Test', filteredCount === loadedData.length,
                    `Original: ${loadedData.length}, After empty filter: ${filteredCount}`);

                // Test 6: Pagination test
                const pageData = DataService.getCurrentPageData();
                const expectedPageSize = Math.min(CONFIG.pagination.itemsPerPage, filteredCount);
                addTest('Pagination Test', pageData.length === expectedPageSize,
                    `Expected: ${expectedPageSize}, Got: ${pageData.length}, First course: ${JSON.stringify(pageData[0]?.code || 'none')}`);

                // Test 7: UI Controller test
                UIController.init();
                UIController.renderTable(pageData);
                const tableRows = document.querySelectorAll('#courseTableBody tr').length;
                addTest('UI Render Test', tableRows > 0,
                    `Table rows rendered: ${tableRows}, Expected: ${pageData.length}`);

            } catch (error) {
                addTest('Error in Tests', false, `Error: ${error.message}\n${error.stack}`);
            }
        }

        // Auto-run on load
        runAllTests();
    </script>

    <!-- Table for UI test -->
    <div style="margin-top: 20px;">
        <h3>Test Table:</h3>
        <table border="1">
            <tbody id="courseTableBody"></tbody>
        </table>
    </div>
</body>
</html>
